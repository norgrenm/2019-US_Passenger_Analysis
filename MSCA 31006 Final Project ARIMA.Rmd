---
title: "MSCA 31006 Fin Proj ARIMA"
author: "Matthew Fligiel"
date: "August 3, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
setwd("~/MSCA/MSCA 31006")
```

Let's begin by loading the data.

```{r}
library(TSA)
library(fpp)
library(tseries)
library(forecast)


passenger = get(load("passenger.rds"))
str(passenger)
head(passenger)

```


Now, we can begin to make this into a time series.  I did domestic here.

```{r}
ps_ts = ts(as.numeric(gsub(",", "", passenger[,3])), start=c(2002, 10), end=c(2020, 4), frequency=12)

str(ps_ts)
plot(ps_ts, ylim=c(0,99000000))
```

I am going to cut out 2020, as this year has not been what anyone expected, wanted, or hoped for.

```{r}
ps_ts = window(ps_ts, start=c(2002, 10), end=c(2019, 12))
ps_ts_train = window(ps_ts, start=c(2002, 10), end=c(2018, 12))
ps_ts_test = window(ps_ts, start=c(2019, 1), end=c(2019, 12))
plot(ps_ts)
```

Now, we can try an auto arima to get a sense of which to use.

```{r}
ps_ts.auto.arima = auto.arima(ps_ts_train, trace = TRUE)
```

```{r}
#look at the auto arima
summary(ps_ts.auto.arima)
checkresiduals(ps_ts.auto.arima)
```

This looks pretty good!  I think that it is worth trying to reduce each of the AR/MA parameters by 1 and see if it is significantly worse.

```{r}
evals = function (model) {
  print(paste("Training Stats - AIC:", model$aic,", AICc:", model$aicc, ", BIC:", model$bic))
}

#baseline
print("baseline")
psts_auto_fcst = forecast(ps_ts.auto.arima, h=12)
accuracy(psts_auto_fcst$mean, ps_ts_test)
evals(ps_ts.auto.arima)
cat("\n")

#changes
print("ARIMA(2,1,2)(1,1,1)[12]")
ps_ts.arima.212.111 = Arima(ps_ts_train, order=c(2,1,2), seasonal=c(1,1,1))
psts_212.111_fcst = forecast(ps_ts.arima.212.111, h=12)
accuracy(psts_212.111_fcst$mean, ps_ts_test)
evals(ps_ts.arima.212.111)
cat("\n")

print("ARIMA(2,1,2)(0,1,2)[12]")
ps_ts.arima.212.012 = Arima(ps_ts_train, order=c(2,1,2), seasonal=c(0,1,2))
psts_212.012_fcst = forecast(ps_ts.arima.212.012, h=12)
accuracy(psts_212.012_fcst$mean, ps_ts_test)
evals(ps_ts.arima.212.012)
cat("\n")

print("ARIMA(2,1,1)(1,1,2)[12]")
ps_ts.arima.211.112 = Arima(ps_ts_train, order=c(2,1,1), seasonal=c(1,1,2))
psts_211.112_fcst = forecast(ps_ts.arima.211.112, h=12)
accuracy(psts_211.112_fcst$mean, ps_ts_test)
evals(ps_ts.arima.211.112)
cat("\n")

print("ARIMA(1,1,2)(1,1,2)[12]")
ps_ts.arima.112.112 = Arima(ps_ts_train, order=c(1,1,2), seasonal=c(1,1,2))
psts_112.112_fcst = forecast(ps_ts.arima.112.112, h=12)
accuracy(psts_112.112_fcst$mean, ps_ts_test)
evals(ps_ts.arima.112.112)
```

The ARIMA (2,1,2)(0,1,2)[12] seems all around to be a better model, especially by BIC and AICc, so we will continue with it as our model. 
